<div id="page-wrapper">
  <div ng-include="'head.html'"></div>
  <br>
  <div class="row">
    <div class="col-lg-12">
      <h3 style="color: #666666;"><i class="fa fa-area-chart"></i> ANALYTICS CHARTS</h3>
      <ol class="breadcrumb">
        <li><i class="fa fa-home"></i><a href="#/dashboard"> Home</a></li>
        <li><i class="fa fa-list"></i> Credit Details Report</li>
      </ol>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12">
      <div class="form-group">
        
        <button type="button" class="btn btn-primary btn-sm"  ng-click="creditDetails()">
          <i class="fa fa-fw fa-filter"></i> Filter
        </button>
        <!-- <button type="button" class="btn btn-success btn-sm" ng-click="adjustment()">
          <i class="fa fa-fw fa-filter"></i> Adjustment
        </button>
        <button type="button" class="btn btn-success btn-sm" ng-click="payment()">
          <i class="fa fa-fw fa-filter"></i> Payment
        </button> -->
        <button type="button" class="btn btn-success btn-sm" ng-click="soa()">
          <i class="fa fa-fw fa-filter"></i> SOA - Statement of Account
        </button>
        <a href="/luckypos/api/database_bkp.php" type="button" class="btn btn-primary btn-sm" >
          <i class="fa fa-fw fa-folder"></i> Backup Database
        </a>
      </div>
    </div>
  </div>
  <div class="row mb-3 px-1">
    <div class="col-lg-6 form-group">
      <div class="white_card mb_30">
        <div class="white_card_header">
          <div class="box_header m-0">
              <div class="main-title">
                <h3 class="m-0">
                  <i class="fa fa-area-chart fa-lg text-primary"></i> Credit Detail
                </h3>
              </div>
          </div>
        </div>
        <div id="chartdiv"></div>
      </div>
    </div>
    <div class="col-lg-6 form-group">
      <div class="white_card mb_30">
        <div class="white_card_header">
          <div class="box_header m-0">
              <div class="main-title">
                <h3 class="m-0">
                  <i class="fa fa-area-chart fa-lg text-primary"></i> Credit Summary
                </h3>
              </div>
          </div>
        </div>
        <div id="chartdiv2"></div>
      </div>
    </div>
  </div>
  <div class="row mb-3 px-1">
    <div class="col-lg-6 form-group">
      <div class="white_card mb_30">
        <div class="white_card_header">
          <div class="box_header m-0">
              <div class="main-title">
                <h3 class="m-0">
                  <i class="fa fa-area-chart fa-lg text-primary"></i> Adjusment
                </h3>
              </div>
          </div>
        </div>
        <div id="chartdiv3"></div>
      </div>
    </div>
    <div class="col-lg-6 form-group">
      <div class="white_card mb_30">
        <div class="white_card_header">
          <div class="box_header m-0">
              <div class="main-title">
                <h3 class="m-0">
                  <i class="fa fa-area-chart fa-lg text-primary"></i> Payment
                </h3>
              </div>
          </div>
        </div>
        <div id="chartdiv4"></div>
      </div>
    </div>
  </div>
  <!-- <div class="row" ng-show = "IsCreditDetail">
    <div class="col-md-12 pull-right">     
     
      <button type="button" class="btn btn-danger btn-sm" id="exportCreditDetails" >
        <i class="fa fa-fw fa-file-pdf-o"></i> Export Excel
      </button>
      <br>
      <br>
      <table id="credit-table" class="export-table table table-bordered table-condensed table-hover table-striped " 
        datatable="ng" dt-instance="vm.creditInstance"  width="100%" dt-options="vm.creditOptions" 
        dt-column-defs="vm.dtColumnDefs" >
        <thead>
          <tr>
            <th>Trxn ID</th>
            <th>Barcode No.</th>
            <th>Customer ID</th>
            <th>Name</th>
            <th>Amount</th>
            <th>Added Date</th>
            <th>Due Date</th>
            <th>Company Name</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="data in credit_report">
            <td>{{data.id}}</td>
            <td>{{data.cust_barcode_num}}</td>
            <td>{{data.cust_id_no}}</td>
            <td>{{data.name}}</td>
            <td>{{ data.amount }}</td>
            <td>{{data.added_date}}</td>
            <td>{{data.due_date}}</td>
            <td>{{data.comp_name}}</td>
          </tr>
        </tbody>
        
      </table>
    </div>
  </div> -->
  <div ng-include="'reports/credit_summary_report.html'"></div>
  <div ng-include="'reports/cash_report.html'"></div>
  <div ng-include="'reports/adjustment_report.html'"></div>
  <div ng-include="'reports/payment_report.html'"></div>
</div>

<div ng-include="'modal/credit_detail_report.html'"></div>
<div ng-include="'modal/summary_detail_report.html'"></div>
<div ng-include="'modal/cash_detail_report.html'"></div>
<div ng-include="'modal/adjustment_report.html'"></div>
<div ng-include="'modal/payment_report.html'"></div>
<div ng-include="'modal/soa.html'"></div>
<script type="text/javascript">

  // Themes begin
  am4core.useTheme(am4themes_animated);
  // Themes end

  // Create chart instance
  var chart = am4core.create("chartdiv", am4charts.XYChart);
  var chart2 = am4core.create("chartdiv2", am4charts.PieChart);
  var chart3 = am4core.create("chartdiv3", am4charts.PieChart);
  var chart4 = am4core.create("chartdiv4", am4charts.PieChart);

  // Add data
  chart.data = [{"id":"7","0":"7","cust_barcode_num":"002523","1":"002523","cust_id_no":"002523","2":"002523","name":"Vailoces, Michael, C.","3":"Vailoces, Michael, C.","amount":"160.00","4":"160.00","added_date":"2023-09-30","5":"2023-09-30","due_date":"2023-10-15","6":"2023-10-15","comp_name":"MSM Philippines","7":"MSM Philippines"},{"id":"6","0":"6","cust_barcode_num":"002524","1":"002524","cust_id_no":"002524","2":"002524","name":"Bucao, Alec, C.","3":"Bucao, Alec, C.","amount":"150.00","4":"150.00","added_date":"2023-09-30","5":"2023-09-30","due_date":"2023-09-30","6":"2023-09-30","comp_name":"OutsourceIT","7":"OutsourceIT"},{"id":"10","0":"10","cust_barcode_num":"002524","1":"002524","cust_id_no":"002524","2":"002524","name":"Bucao, Alec, C.","3":"Bucao, Alec, C.","amount":"600.00","4":"600.00","added_date":"2023-09-30","5":"2023-09-30","due_date":"2023-09-30","6":"2023-09-30","comp_name":"OutsourceIT","7":"OutsourceIT"},{"id":"8","0":"8","cust_barcode_num":"2023060116","1":"2023060116","cust_id_no":"2023060116","2":"2023060116","name":"Ibrahim, Lillia, B","3":"Ibrahim, Lillia, B","amount":"200.00","4":"200.00","added_date":"2023-09-30","5":"2023-09-30","due_date":"2023-10-15","6":"2023-10-15","comp_name":"OutsourceIT","7":"OutsourceIT"},{"id":"9","0":"9","cust_barcode_num":"2023060116","1":"2023060116","cust_id_no":"2023060116","2":"2023060116","name":"Ibrahim, Lillia, B","3":"Ibrahim, Lillia, B","amount":"50.00","4":"50.00","added_date":"2023-09-30","5":"2023-09-30","due_date":"2023-09-30","6":"2023-09-30","comp_name":"OutsourceIT","7":"OutsourceIT"},{"id":"16","0":"16","cust_barcode_num":"2023060116","1":"2023060116","cust_id_no":"2023060116","2":"2023060116","name":"Ibrahim, Lillia, B","3":"Ibrahim, Lillia, B","amount":"305.00","4":"305.00","added_date":"2023-09-15","5":"2023-09-15","due_date":"2023-09-30","6":"2023-09-30","comp_name":"OutsourceIT","7":"OutsourceIT"},{"id":"11","0":"11","cust_barcode_num":"432424","1":"432424","cust_id_no":"432424","2":"432424","name":"Mingasca, Ireseddd, P.","3":"Mingasca, Ireseddd, P.","amount":"200.00","4":"200.00","added_date":"2023-09-30","5":"2023-09-30","due_date":"2023-09-30","6":"2023-09-30","comp_name":"Cebu General Services, Inc.","7":"Cebu General Services, Inc."},{"id":"12","0":"12","cust_barcode_num":"432424","1":"432424","cust_id_no":"432424","2":"432424","name":"Mingasca, Ireseddd, P.","3":"Mingasca, Ireseddd, P.","amount":"30.00","4":"30.00","added_date":"2023-09-15","5":"2023-09-15","due_date":"2023-09-30","6":"2023-09-30","comp_name":"Cebu General Services, Inc.","7":"Cebu General Services, Inc."},{"id":"13","0":"13","cust_barcode_num":"432424","1":"432424","cust_id_no":"432424","2":"432424","name":"Mingasca, Ireseddd, P.","3":"Mingasca, Ireseddd, P.","amount":"300.00","4":"300.00","added_date":"2023-09-15","5":"2023-09-15","due_date":"2023-09-30","6":"2023-09-30","comp_name":"Cebu General Services, Inc.","7":"Cebu General Services, Inc."},{"id":"14","0":"14","cust_barcode_num":"432424","1":"432424","cust_id_no":"432424","2":"432424","name":"Mingasca, Ireseddd, P.","3":"Mingasca, Ireseddd, P.","amount":"-2.00","4":"-2.00","added_date":"2023-09-15","5":"2023-09-15","due_date":"2023-09-30","6":"2023-09-30","comp_name":"Cebu General Services, Inc.","7":"Cebu General Services, Inc."},{"id":"15","0":"15","cust_barcode_num":"432424","1":"432424","cust_id_no":"432424","2":"432424","name":"Mingasca, Ireseddd, P.","3":"Mingasca, Ireseddd, P.","amount":"0.00","4":"0.00","added_date":"2023-09-15","5":"2023-09-15","due_date":"2023-09-30","6":"2023-09-30","comp_name":"Cebu General Services, Inc.","7":"Cebu General Services, Inc."}];

   chart2.data = [{"cust_barcode_num":"432424","0":"432424","cust_id_no":"432424","1":"432424","name":"Mingasca, Ireseddd, P.","2":"Mingasca, Ireseddd, P.","amount":"528.00","3":"528.00","due_date":"2023-09-30","4":"2023-09-30","comp_name":"Cebu General Services, Inc.","5":"Cebu General Services, Inc.","added_date":"2023-09-30","6":"2023-09-30"},{"cust_barcode_num":"002523","0":"002523","cust_id_no":"002523","1":"002523","name":"Vailoces, Michael, C.","2":"Vailoces, Michael, C.","amount":"160.00","3":"160.00","due_date":"2023-10-15","4":"2023-10-15","comp_name":"MSM Philippines","5":"MSM Philippines","added_date":"2023-09-30","6":"2023-09-30"},{"cust_barcode_num":"2023060116","0":"2023060116","cust_id_no":"2023060116","1":"2023060116","name":"Ibrahim, Lillia, B","2":"Ibrahim, Lillia, B","amount":"355.00","3":"355.00","due_date":"2023-09-30","4":"2023-09-30","comp_name":"OutsourceIT","5":"OutsourceIT","added_date":"2023-09-30","6":"2023-09-30"},{"cust_barcode_num":"002524","0":"002524","cust_id_no":"002524","1":"002524","name":"Bucao, Alec, C.","2":"Bucao, Alec, C.","amount":"750.00","3":"750.00","due_date":"2023-09-30","4":"2023-09-30","comp_name":"OutsourceIT","5":"OutsourceIT","added_date":"2023-09-30","6":"2023-09-30"},{"cust_barcode_num":"2023060116","0":"2023060116","cust_id_no":"2023060116","1":"2023060116","name":"Ibrahim, Lillia, B","2":"Ibrahim, Lillia, B","amount":"200.00","3":"200.00","due_date":"2023-10-15","4":"2023-10-15","comp_name":"OutsourceIT","5":"OutsourceIT","added_date":"2023-09-30","6":"2023-09-30"}];

   chart3.data = [{"id":"17","0":"17","cust_barcode_num":"2023060116","1":"2023060116","adjtype":"Credit","2":"Credit","cust_id_no":"2023060116","3":"2023060116","name":"Ibrahim, Lillia, B","4":"Ibrahim, Lillia, B","amount":"100.00","5":"100.00","added_date":"2023-09-15","6":"2023-09-15","due_date":"2023-08-31 00:00:00","7":"2023-08-31 00:00:00","comp_name":"OutsourceIT","8":"OutsourceIT","reason":"vdbdfd","9":"vdbdfd"},{"id":"20","0":"20","cust_barcode_num":"2023060116","1":"2023060116","adjtype":"Credit","2":"Credit","cust_id_no":"2023060116","3":"2023060116","name":"Ibrahim, Lillia, B","4":"Ibrahim, Lillia, B","amount":"77.00","5":"77.00","added_date":"2023-09-15","6":"2023-09-15","due_date":"2023-10-15 00:00:00","7":"2023-10-15 00:00:00","comp_name":"OutsourceIT","8":"OutsourceIT","reason":"fsdds","9":"fsdds"},{"id":"21","0":"21","cust_barcode_num":"2023060116","1":"2023060116","adjtype":"Debit","2":"Debit","cust_id_no":"2023060116","3":"2023060116","name":"Ibrahim, Lillia, B","4":"Ibrahim, Lillia, B","amount":"-77.00","5":"-77.00","added_date":"2023-09-15","6":"2023-09-15","due_date":"2023-10-15 00:00:00","7":"2023-10-15 00:00:00","comp_name":"OutsourceIT","8":"OutsourceIT","reason":"ghfgh","9":"ghfgh"},{"id":"18","0":"18","cust_barcode_num":null,"1":null,"adjtype":"Credit","2":"Credit","cust_id_no":"","3":"","name":null,"4":null,"amount":"100.00","5":"100.00","added_date":"2023-09-15","6":"2023-09-15","due_date":"2023-09-30 00:00:00","7":"2023-09-30 00:00:00","comp_name":"OutsourceIT","8":"OutsourceIT","reason":"fdfs","9":"fdfs"},{"id":"19","0":"19","cust_barcode_num":null,"1":null,"adjtype":"Debit","2":"Debit","cust_id_no":"","3":"","name":null,"4":null,"amount":"-10.00","5":"-10.00","added_date":"2023-09-15","6":"2023-09-15","due_date":"2023-08-15 00:00:00","7":"2023-08-15 00:00:00","comp_name":"OutsourceIT","8":"OutsourceIT","reason":"gdf","9":"gdf"}];

   chart4.data = [{"id":"1","0":"1","amount":"-150.25","1":"-150.25","added_date":"2023-09-15","2":"2023-09-15","due_date":"2023-09-30","3":"2023-09-30","comp_name":"OutsourceIT","4":"OutsourceIT"},{"id":"2","0":"2","amount":"-1445.25","1":"-1445.25","added_date":"2023-09-18","2":"2023-09-18","due_date":"2023-09-30","3":"2023-09-30","comp_name":"OutsourceIT","4":"OutsourceIT"},{"id":"3","0":"3","amount":"-100.50","1":"-100.50","added_date":"2023-09-18","2":"2023-09-18","due_date":"2023-10-15","3":"2023-10-15","comp_name":"OutsourceIT","4":"OutsourceIT"}];


  // Create axes
  var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
  categoryAxis.dataFields.category = "added_date";
  categoryAxis.renderer.grid.template.location = 0;
  categoryAxis.renderer.minGridDistance = 30;

  var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());

  // Create series
  var series = chart.series.push(new am4charts.ColumnSeries());
  series.dataFields.valueY = "amount";
  series.dataFields.categoryX = "added_date";
  series.name = "Visits";
  series.columns.template.tooltipText = "{categoryX}: [bold]{valueY}[/]";
  series.columns.template.fillOpacity = .8;

  var columnTemplate = series.columns.template;
  columnTemplate.strokeWidth = 2;
  columnTemplate.strokeOpacity = 1;

  // Create PieSeries
  var pieSeries = chart2.series.push(new am4charts.PieSeries());
  pieSeries.dataFields.value = "amount";
  pieSeries.dataFields.category = "added_date";
  chart2.innerRadius = am4core.percent(30);

  pieSeries.slices.template.stroke = am4core.color("#fff");
  pieSeries.slices.template.strokeWidth = 2;
  pieSeries.slices.template.strokeOpacity = 1;
  pieSeries.slices.template
      .cursorOverStyle = [
          {
              "property": "cursor",
              "value": "pointer"
          }
      ];

  pieSeries.alignLabels = false;
  pieSeries.labels.template.bent = true;
  pieSeries.labels.template.radius = 3;
  pieSeries.labels.template.padding(0, 0, 0, 0);

  pieSeries.ticks.template.disabled = true;

  var shadow = pieSeries.slices.template.filters.push(new am4core.DropShadowFilter);
  shadow.opacity = 0;

  var hoverState = pieSeries.slices.template.states.getKey("hover"); 
  var hoverShadow = hoverState.filters.push(new am4core.DropShadowFilter);
  hoverShadow.opacity = 0.7;
  hoverShadow.blur = 5;

  chart2.legend = new am4charts.Legend();

  
   // Create PieSeries
  var pieSeries = chart3.series.push(new am4charts.PieSeries());
  pieSeries.dataFields.value = "amount";
  pieSeries.dataFields.category = "added_date";
  chart3.innerRadius = am4core.percent(30);

  pieSeries.slices.template.stroke = am4core.color("#fff");
  pieSeries.slices.template.strokeWidth = 2;
  pieSeries.slices.template.strokeOpacity = 1;
  pieSeries.slices.template
      .cursorOverStyle = [
          {
              "property": "cursor",
              "value": "pointer"
          }
      ];

  pieSeries.alignLabels = false;
  pieSeries.labels.template.bent = true;
  pieSeries.labels.template.radius = 3;
  pieSeries.labels.template.padding(0, 0, 0, 0);

  pieSeries.ticks.template.disabled = true;

  var shadow = pieSeries.slices.template.filters.push(new am4core.DropShadowFilter);
  shadow.opacity = 0;

  var hoverState = pieSeries.slices.template.states.getKey("hover"); 
  var hoverShadow = hoverState.filters.push(new am4core.DropShadowFilter);
  hoverShadow.opacity = 0.7;
  hoverShadow.blur = 5;

  chart3.legend = new am4charts.Legend();

   // Create PieSeries
  var pieSeries = chart4.series.push(new am4charts.PieSeries());
  pieSeries.dataFields.value = "amount";
  pieSeries.dataFields.category = "added_date";
  chart4.innerRadius = am4core.percent(30);

  pieSeries.slices.template.stroke = am4core.color("#fff");
  pieSeries.slices.template.strokeWidth = 2;
  pieSeries.slices.template.strokeOpacity = 1;
  pieSeries.slices.template
      .cursorOverStyle = [
          {
              "property": "cursor",
              "value": "pointer"
          }
      ];

  pieSeries.alignLabels = false;
  pieSeries.labels.template.bent = true;
  pieSeries.labels.template.radius = 3;
  pieSeries.labels.template.padding(0, 0, 0, 0);

  pieSeries.ticks.template.disabled = true;

  var shadow = pieSeries.slices.template.filters.push(new am4core.DropShadowFilter);
  shadow.opacity = 0;

  var hoverState = pieSeries.slices.template.states.getKey("hover"); 
  var hoverShadow = hoverState.filters.push(new am4core.DropShadowFilter);
  hoverShadow.opacity = 0.7;
  hoverShadow.blur = 5;

  chart4.legend = new am4charts.Legend();

</script>


<!-- <script type="text/javascript">
   class csvExport {
  constructor(table, header = true) {
    this.table = table;
    this.rows = Array.from(table.querySelectorAll("tr"));
    if (!header && this.rows[0].querySelectorAll("th").length) {
      this.rows.shift();
    }
    // console.log(this.rows);
    // console.log(this._longestRow());
  }

  exportCsv() {
    const lines = [];
    const ncols = this._longestRow();
    for (const row of this.rows) {
      let line = "";
      for (let i = 0; i < ncols; i++) {
        if (row.children[i] !== undefined) {
          line += csvExport.safeData(row.children[i]);
        }
        line += i !== ncols - 1 ? "," : "";
      }
      lines.push(line);
    }
    //console.log(lines);
    return lines.join("\n");
  }
  _longestRow() {
    return this.rows.reduce((length, row) => (row.childElementCount > length ? row.childElementCount : length), 0);
  }
  static safeData(td) {
    let data = td.textContent;
    //Replace all double quote to two double quotes
    data = data.replace(/"/g, `""`);
    //Replace , and \n to double quotes
    data = /[",\n"]/.test(data) ? `"${data}"` : data;
    return data;
  }
}

const btnExport = document.querySelector("#exportCreditDetails");
const tableElement = document.querySelector("#credit-table");

btnExport.addEventListener("click", () => {
  const obj = new csvExport(tableElement);
  const csvData = obj.exportCsv();
  const blob = new Blob([csvData], { type: "text/csv" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "DailyTrxn.csv";
  a.click();

  setTimeout(() => {
    URL.revokeObjectURL(url);
  }, 500);
});
    </script> -->
